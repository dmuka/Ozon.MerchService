services:
  merch_service:
    image: ghcr.io/dmuka/ozon.merchservice:sha256-fbd3954865ecbf4537acfccec3ca4fb928d05c1050f960484595a801cf9b4012.sig
    build:
      context: .
      dockerfile: src/Ozon.MerchService/Dockerfile
    ports:
      - name: http
        target: 8080
        published: 5002
          
      - name: grpc
        target: 8081
        published: 5003
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:8081;http://+:8080
      - DatabaseConnectionOptions__ConnectionString="Host=host.docker.internal;Port=5426;Database=merch;Username=postgres;Password=merch_password"
    depends_on:
      - merch_db
    command: "-c log_statement=all"

  merch_db:
    image: postgres:latest
    ports: 
      - 5426:5432
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: merch_password
      POSTGRES_DB: merch
    command: "-c log_statement=all"
        